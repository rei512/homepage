{{/* iframe内ページのナビゲーション通知スクリプト */}}
<script>
(function() {
  'use strict';

  // 親フレームにナビゲーションを通知する関数
  function notifyParentNavigation() {
    if (window.parent && window.parent !== window) {
      // iframe URLから通常URLを生成（/posts/first-post/iframe/ → /posts/first-post/）
      const currentPath = window.location.pathname;
      const normalPath = currentPath.replace(/\/iframe\/$/, '/');

      window.parent.postMessage({
        type: 'navigation',
        url: normalPath
      }, window.location.origin);
    }
  }

  // ページロード時に通知
  notifyParentNavigation();

  // iframe内のリンククリック時も通知（optional: 既にtarget="_self"で遷移するため）
  document.addEventListener('click', function(e) {
    const link = e.target.closest('a[href]');
    if (link && link.getAttribute('target') === '_self') {
      // リンク先がiframe URLの場合のみ通知
      const href = link.getAttribute('href');
      if (href && href.includes('/iframe/')) {
        setTimeout(notifyParentNavigation, 100);
      }
    }
  });
})();
</script>
